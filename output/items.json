[
  {
    "kind": "context",
    "text": "L'histoire commence le 21 avril 1933, dans une petite ville de province, ici ou ailleurs‚Ä¶\nM. Germain, 45 ans, est notre personnage principal."
  },
  {
    "kind": "adventure",
    "text": "√âcrivez une requ√™te SQL renvoyant le nom et l'adresse de ce M. Germain. <br>_Aide._ Utilisez l'op√©rateur `LIKE` sur la table `person`.",
    "query": "SELECT person, complement, num, street\nFROM person A\nWHERE person LIKE \"% Germain\"\n    AND sex = \"M\"\n    AND age = 45",
    "formula": "salt_064(sum(A.hash) OVER()) AS token",
    "entry_token": "35475034373353",
    "output_token": "139825195129217"
  },
  {
    "kind": "hint",
    "text": "Le M. Germain qui nous int√©resse a 45 ans.",
    "query": "SELECT person, complement, num, street\nFROM person A\nWHERE person LIKE \"% Germain\"\n    AND sex = \"M\"",
    "formula": "salt_064(sum(A.hash) OVER()) AS token",
    "entry_token": "334297691685878"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux individus de sexe masculin.",
    "query": "SELECT person, complement, num, street\nFROM person A\nWHERE person LIKE \"% Germain\"\n    AND age = 45",
    "formula": "salt_064(sum(A.hash) OVER()) AS token",
    "entry_token": "149100025407851"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux individus de sexe masculin.",
    "query": "SELECT person, complement, num, street\nFROM person A\nWHERE person LIKE \"% Germain\"",
    "formula": "salt_064(sum(A.hash) OVER()) AS token",
    "entry_token": "484859766608600"
  },
  {
    "kind": "context",
    "text": "La premi√®re sc√®ne se d√©roule dans une cour de ferme. Il y a l√† une vieille femme v√™tue de noir, Mme Henriette Beaug√©. Silencieuse, elle est √† l'√©coute de tous les bruits qui viennent de la maison. Des voisines sont √† ses c√¥t√©s.\n\nEnfin un homme sort de la maison, l'air grave. C'est Germain. Ses mains et ses poignets sont tach√©s de sang. Il les plonge dans une barrique pleine d'eau et les frotte en silence. La grand-m√®re s'est lev√©e. Elle vient √† lui √† petits pas, lui apportant son chapeau et sa redingote.\n\n- La m√®re est sauv√©e, l√¢che-t-il.\n- Et l'enfant¬†?\n\nIl la regarde dans les yeux, met son chapeau, secoue la t√™te.\n\n- Non.  \n- Mon Dieu, docteur... Vous n'avez pas fait √ßa¬†?  \n- Je l'ai fait, r√©pond-il. En conscience.  \n\nApr√®s un moment, il reprend¬†:  \n\n- Si vous tenez √† avoir un petit-fils... Dans... dans six ou huit mois ‚Äî mais pas avant, hein¬†! ‚Äî vous demanderez √† votre gendre de lui en faire un autre.\n\nLes deux voisines, rest√©es un peu en retrait, commentent √† mi-voix¬†:  \n\n- Il a d√©j√† eu du mal la premi√®re fois...  \n- Il se fera aider par un voisin¬†!"
  },
  {
    "kind": "question",
    "text": "√âcrivez une requ√™te donnant le nom des voisines. <br>_Aide._ Vous aurez besoin de la table `relation` qui, pour certaines personnes, donne la nature de leur relation avec certaines autres. Cette table est sym√©trique, c'est-√†-dire par exemple que si la personne 1 est r√©pertori√©e comme fille des personnes 2 et 3, les personnes 2 et 3 sont √©galement r√©pertori√©es comme p√®re et m√®re de la personne 1.",
    "query": "SELECT person_1\nFROM relation A\nWHERE person_2 = \"Henriette Beaug√©\"\n    AND nature = \"voisine\"",
    "formula": "salt_002(sum(A.hash) OVER()) AS token",
    "entry_token": "139825195129217",
    "output_token": "26814008885635"
  },
  {
    "kind": "hint",
    "text": "On demande les voisines de Mme Beaug√©, pas tous ses voisins.",
    "query": "SELECT DISTINCT person_1\nFROM relation A\nWHERE person_2 = \"Henriette Beaug√©\"\n    AND nature LIKE \"voisin%\";",
    "formula": "salt_002(sum(A.hash) OVER()) AS token",
    "entry_token": "397194862914975"
  },
  {
    "kind": "hint",
    "text": "On demande les voisines de Mme Beaug√©, et non les personnes dont Mme Beaug√© est la voisine.",
    "query": "SELECT person_2\nFROM relation A\nWHERE person_1 = \"Henriette Beaug√©\"\n    AND nature = \"voisine\"",
    "formula": "salt_002(sum(A.hash) OVER()) AS token",
    "entry_token": "531466186008040"
  },
  {
    "kind": "context",
    "text": "Le m√©decin est rentr√© dans sa voiture. Avant de d√©marrer, il prend les mains de la vieille femme¬†:  \n\n- Ne pleurez pas, grand-m√®re. Vous gardez votre fille. C'est l'essentiel.\n\nPendant ce temps, dans la salle commune de l'h√¥pital de Saint-Robin, une infirmi√®re au visage ferm√©, √† l'air rev√™che, vient de poser un verre sur la table de chevet d'un jeune homme. Celui-ci tente p√©niblement de le prendre.\n\n- Quand vous aurez fini de g√©mir, lui lance-t-elle...  \n- Je ne peux pas me relever...  \n- Eh bien, restez couch√© ! dit-elle en quittant la salle.  \n\nUne autre employ√©e se trouve l√†, les bras charg√©s de livres qu'elle distribue aux malades. C'est l'√©pouse du docteur Vorzet, qui dirige le service des ali√©n√©s. Elle s'approche et, avec beaucoup de douceur, aide le malade √† se redresser. Il la prend √† t√©moin¬†:\n\n- C'est une m√©chante femme.  \n- Allons... Ne parlez pas ainsi. C'est ma s≈ìur.  \n- Pardon... c'est une m√©chante s≈ìur.  \n- Non, c'est une malheureuse... Elle l'a toujours √©t√©."
  },
  {
    "kind": "question",
    "text": "Extrayez de la table `relation` deux lignes comportant, √† gauche le nom de l'infirmi√®re et de sa s≈ìur, et √† droite celui du Dr. Vorzet. <br>_Aide._ La s≈ìur de ma femme est ma _____-____.",
    "query": "SELECT person_1, nature, person_2\nFROM relation A\nWHERE (nature = \"femme\"\n       OR nature = \"belle-soeur\")\n    AND person_2 LIKE \"% Vorzet\"",
    "formula": "salt_048(sum(A.hash) OVER()) AS token",
    "entry_token": "26814008885635",
    "output_token": "132632717410880"
  },
  {
    "kind": "variant",
    "text": "Avec l'op√©rateur d'appartenance `IN`.",
    "query": "SELECT person_1, nature, person_2\nFROM relation A\nWHERE nature IN (\"femme\", \"belle-s≈ìur\")\n    AND person_2 LIKE \"% Vorzet\"",
    "formula": "salt_048(sum(A.hash) OVER()) AS token"
  },
  {
    "kind": "hint",
    "text": "Votre expression bool√©enne n'est pas correctement parenth√©s√©e. Souvenez-vous que le `AND` est prioritaire sur le `OR`.",
    "query": "SELECT person_1, nature, person_2\nFROM relation A\nWHERE nature = \"femme\"\n    OR nature = \"belle-soeur\"\n    AND person_2 LIKE \"% Vorzet\"",
    "formula": "salt_048(sum(A.hash) OVER()) AS token",
    "entry_token": "2381533976680876"
  },
  {
    "kind": "hint",
    "text": "Votre expression bool√©enne n'est pas correctement parenth√©s√©e. Souvenez-vous que le `AND` est prioritaire sur le `OR`.",
    "query": "SELECT person_1, nature, person_2\nFROM relation A\nWHERE person_2 LIKE \"% Vorzet\"\n    AND nature = \"femme\"\n    OR nature = \"belle-soeur\"",
    "formula": "salt_048(sum(A.hash) OVER ()) AS token",
    "entry_token": "55091582265641"
  },
  {
    "kind": "hint",
    "text": "Vous avez trouv√© la belle-s≈ìur de M. Vorzet. Il nous faut aussi sa femme.",
    "query": "SELECT person_1\nFROM relation A\nWHERE nature = \"belle-soeur\"\n    AND person_2 = \"Michel Vorzet\"",
    "formula": "salt_048(sum(A.hash) OVER ()) AS token",
    "entry_token": "231631829303435"
  },
  {
    "kind": "hint",
    "text": "Vous avez trouv√© la s≈ìur de Mme Vorzet. Ce n'est pas ce qui est demand√©.",
    "query": "SELECT person_1\nFROM relation A\nWHERE person_2 LIKE \"%Vorzet\"\n    AND nature = \"soeur\"",
    "formula": "salt_048(sum(A.hash) OVER ()) AS token",
    "entry_token": "217127608282287"
  },
  {
    "kind": "hint",
    "text": "Vous avez trouv√© la femme de M. Vorzet. Il nous faut aussi sa belle-s≈ìur.",
    "query": "SELECT person_1\nFROM relation A\nWHERE person_2 LIKE \"%Vorzet\"\n    AND nature = \"femme\"",
    "formula": "salt_048(sum(A.hash) OVER ()) AS token",
    "entry_token": "187636243862125"
  },
  {
    "kind": "context",
    "text": "- Tenez, vous lirez √ßa ce soir, dit Laura Vorzet.  \n\nLe malade regarde distraitement la couverture du livre qu'elle lui apporte et, √† br√ªle-pourpoint¬†:\n\n- Madame... Est-ce que... est-ce que votre mari pourrait me faire changer de lit¬†?  \n- De lit¬†?  \n- Oui, le mien a ce num√©ro qui porte malheur... Si je reste ici, il m'arrivera quelque chose."
  },
  {
    "kind": "question",
    "text": "Qui est ce patient ? <br>_Aide._ Vous devez deviner le num√©ro du lit (stock√© comme un entier), et rechercher qui est hospitalis√© ce jour-l√† dans ce lit. Relisez le d√©but de l'histoire si vous ne souvenez plus quel jour elle commence. Chaque ligne de la table `consultation` donne les noms d'un patient et du m√©decin qui l'a examin√©. Si cette consultation a donn√© lieu √† une hospitalisation, celle-ci se trouve dans la table `hospitalization`, sous le m√™me identifiant, avec les dates d'entr√©e et de sortie, ainsi que le num√©ro de lit. L'information √©tant r√©partie dans ces deux tables, vous avez besoin d'une jointure.",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING(consultation)\nWHERE bed = 13\n    AND \"1933-04-21\" BETWEEN check_in AND check_out",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "132632717410880",
    "output_token": "548639268795494"
  },
  {
    "kind": "hint",
    "text": "On ne cherche pas les patients ayant pass√© une consultation le 21 avril 1933. Relisez l'√©nonc√©.",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING (consultation)\nWHERE date = \"1933-04-21\"",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "110517508006323"
  },
  {
    "kind": "hint",
    "text": "Vous avez trouv√© le bon num√©ro de lit. Cependant, on ne cherche pas les patients qui ont √©t√© hospitalis√©s le jour de leur consultation, mais ceux qui se trouvent √† l'h√¥pital le 21 avril 1933.",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING (consultation)\nWHERE A.date = B.check_in\n    AND B.bed = 13",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "1763959691028667"
  },
  {
    "kind": "hint",
    "text": "Plusieurs Fran√ßois ont √©t√© hospitalis√©s. Utilisez les dates d'hospitalisation et le num√©ro de lit pour trouver le bon.",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING (consultation)\nWHERE A.patient LIKE \"Fran√ßois%\";",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "665454391990493"
  },
  {
    "kind": "hint",
    "text": "Quel num√©ro porte malheur en France¬†?",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING (consultation)\nWHERE \"1933-04-21\" BETWEEN check_in AND check_out\n    AND patient LIKE \"Fran√ßois %\"",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "824753229677455"
  },
  {
    "kind": "hint",
    "text": "Vous avez trouv√© le bon num√©ro de lit, mais on ne s'int√©resse pas √† tous les malades qui s'y sont succ√©d√©. Souvenez-vous¬†: nous sommes le 21 avril 1933.",
    "query": "SELECT patient\nFROM consultation A\nJOIN hospitalization B USING (consultation)\nWHERE bed = 13",
    "formula": "salt_073(sum(A.hash + B.hash) OVER ()) AS token",
    "entry_token": "4701277967254422"
  },
  {
    "kind": "context",
    "text": "- Ne dites pas de sottises, dit Laura avec un sourire... Tenez, voil√† votre m√®re qui vous rend visite. Je vous laisse.\n\nLe visage de l'homme s'est √©clair√©.\n\n- Bonjour, maman.  \n- Bonjour, Fran√ßois.  \n\nElle l'embrasse.  \n\n- Oh¬†! tu as le visage en sueur. Comment vas-tu¬†? Tiens, je t'ai apport√© un nouveau rasoir.\n\nIl prend l'objet entre ses mains, l'ouvre. Il pose le fil de la lame sur son ongle et entreprend de le tailler.\n\n----\n\nEn sortant de la salle commune, Laura Vorzet est tomb√©e sur sa s≈ìur¬†:\n\n- Marie, pourquoi es-tu si d√©sagr√©able avec les malades¬†?¬†¬†\n- Pourquoi es-tu si aimable avec le docteur Germain ?¬†¬†\n- Qu'est-ce que tu dis¬†?¬†¬†\n- Je dis que depuis quelque temps, on te voit beaucoup trop dans son service. Je le signalerai √† Michel quand il rentrera.¬†¬†\n- Mon mari est au courant et il trouve √ßa tr√®s bien.¬†¬†\n- D'autres trouvent √ßa tr√®s mal.¬†¬†\n- Mais enfin, tout de m√™me, c'est mon devoir¬†: je suis assistante sociale¬†!  \n- Tu es une tra√Æn√©e¬†!¬†¬†\n\n√Ä ce moment, la porte s'ouvre. Elles se taisent. C'est le docteur Germain. Il les salue, traverse le corridor et entre dans le bureau d'un confr√®re."
  },
  {
    "kind": "question",
    "text": "Dressez la liste du personnel de l'h√¥pital de Saint-Robin avec, pour chaque membre, sa fonction dans l'√©tablissement. <br>_Aide._ Pour chaque personne de la table `person`, vous avez une cl√© √©trang√®re vers la table `job` qui va vous permettre de retrouver le nom de son m√©tier, ainsi que la structure qui l'emploie.",
    "query": "SELECT person\nFROM person A\nJOIN job B USING(job)\nWHERE structure = \"h√¥pital\"",
    "formula": "salt_060(sum(A.hash) OVER()) AS token",
    "entry_token": "548639268795494",
    "output_token": "1402152924966667"
  },
  {
    "kind": "variant",
    "text": "En imbriqu√©.",
    "query": "SELECT person\nFROM person A\nJOIN job B USING(job)\nWHERE job in\n        (SELECT job\n         FROM job\n         WHERE structure = \"h√¥pital\" )",
    "formula": "salt_060(sum(A.hash) OVER()) AS token"
  },
  {
    "kind": "context",
    "text": "- Alors ? dit le docteur Bertrand √† l'entr√©e de son confr√®re.\n- J'ai sauv√© la m√®re.\n- Encore ?¬†¬†\n- Pourquoi, encore ?¬†¬†\n- C'est la troisi√®me fois en six semaines.¬†¬†\n- Si vous ne me faites pas confiance, pourquoi vous d√©charger sur moi de ces consultations ?¬†¬†\n- Oh¬†! rassurez-vous¬†: je ne vous imposerai plus ce d√©rangement !"
  },
  {
    "kind": "question",
    "text": "Donnez la liste des accouchements assur√©s par le docteur Germain au cours des six derni√®res semaines (avec le num√©ro et la date de la consultation, le nom et l'√¢ge de la patiente) ordonn√©e par date croissante. Le r√©sultat vous permettra (facultativement) d'en d√©duire le nom de la fille de Mme Beaug√©. <br>_Aide._ Vous avez besoin d'une jointure triple. Un accouchement est stock√© comme une `consultation` dont le `diagnostic` inclut ¬´¬†accouchement¬†¬ª dans la colonne `trouble`. Utilisez la fonction `SUBDATE()` pour calculer proprement la date de d√©but de cette p√©riode.",
    "query": "SELECT A.consultation, A.date, A.patient, B.age\nFROM consultation A\nJOIN person B ON(patient = person)\nJOIN diagnostic C USING(consultation)\nWHERE doctor = \"R√©my Germain\"\n    AND trouble = \"accouchement\"\n    AND date BETWEEN subdate(\"1933-04-21\", INTERVAL 6 WEEK) AND \"1933-04-21\"\nORDER BY date",
    "formula": "salt_069(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "1402152924966667",
    "output_token": "1491886236279858"
  },
  {
    "kind": "hint",
    "text": "On veut les accouchements assur√©s par le docteur Germain.",
    "query": "SELECT A.consultation, A.date, A.patient, B.age\nFROM consultation A\nJOIN person B ON(patient = person)\nJOIN diagnostic C USING(consultation)\nWHERE trouble = \"accouchement\"\n    AND date BETWEEN subdate(\"1933-04-21\", 6 * 7) AND \"1933-04-21\"\nORDER BY date",
    "formula": "salt_069(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "2693598191447084"
  },
  {
    "kind": "hint",
    "text": "La fonction `SUBDATE()` renvoie une date, pas un bool√©en.",
    "query": "SELECT A.consultation, A.date, A.patient, B.age\nFROM consultation A\nJOIN person B ON(patient = person)\nJOIN diagnostic C USING(consultation)\nWHERE doctor = \"R√©my Germain\"\n    AND trouble = \"accouchement\"\n    AND subdate(\"1933-04-21\", 6 * 7)\nORDER BY date",
    "formula": "salt_069(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "2534109147541957"
  },
  {
    "kind": "context",
    "text": "√Ä ce moment, le docteur Delorme entre √† son tour dans le bureau.\n\n- Encore en train de vous chamailler¬†?\n- Ah¬†! M. le Directeur, jugez plut√¥t... commence le docteur Bertrand.\n- Oh, non, non¬†! Ne me m√™lez pas √† vos bisbilles. Tenez. J'ai rentr√© ce matin un cas de gangr√®ne tout √† fait pittoresque... Le tibia est sorti de la jambe de plus de dix centim√®tres !\n- Dix centim√®tres ! s'exclame le docteur Bertrand. Vous blaguez¬†?\n- Si je vous le dis¬†! Allez, au lieu de vous disputer, venez tous les deux avec moi.\n- Je vous demande pardon, M. le Directeur, r√©pond le docteur Germain, mais je ne suis gu√®re amateur de blagues.\n- Tant pis pour vous. Le docteur Bertrand profitera seul du spectacle. Mais vous le regretterez !\n- J'en suis s√ªr, fait Germain.\n- Vous allez voir, mon cher Bertrand, c'est tordant !"
  },
  {
    "kind": "question",
    "text": "Quel patient du docteur Delorme pr√©sente ce pittoresque cas de gangr√®ne¬†? <br>_Aide._ On s'int√©resse √† la date d'hospitalisation de ce patient, non √† sa date de consultation.",
    "query": "SELECT C.patient\nFROM consultation C\nJOIN hospitalization H USING(consultation)\nJOIN diagnostic D USING(consultation)\nWHERE H.check_in = \"1933-04-21\"\n    AND C.doctor LIKE \"% Delorme\"\n    AND D.trouble = \"gangr√®ne\"",
    "formula": "salt_090(sum(C.hash) OVER()) AS token",
    "entry_token": "1491886236279858",
    "output_token": "4759373510280"
  },
  {
    "kind": "hint",
    "text": "V√©rifiez que vous restreignez bien le r√©sultat √† la date d'hospitalisation du patient. V√©rifiez √©galement que vous faites bien une jointure entre `consultation` et `hospitalization`, et non un simple produit cart√©sien.",
    "query": "SELECT C.patient\nFROM consultation C\nJOIN hospitalization H USING(consultation)\nJOIN diagnostic D USING(consultation)\nWHERE C.doctor LIKE \"% Delorme\"\n    AND D.trouble = \"gangr√®ne\"",
    "formula": "salt_090(sum(C.hash) OVER()) AS token",
    "entry_token": "290373066499138"
  },
  {
    "kind": "hint",
    "text": "C'est le docteur Delorme lui-m√™me qui a fait hospitaliser ce patient.",
    "query": "SELECT C.patient\nFROM consultation C\nJOIN hospitalization H USING(consultation)\nJOIN diagnostic D USING(consultation)\nWHERE H.check_in = \"1933-04-21\"\n    AND D.trouble = \"gangr√®ne\"",
    "formula": "salt_090(sum(C.hash) OVER()) AS token",
    "entry_token": "72591397728089"
  },
  {
    "kind": "hint",
    "text": "Il s'agit d'un cas de gangr√®ne.",
    "query": "SELECT C.patient\nFROM consultation C\nJOIN hospitalization H USING(consultation)\nWHERE H.check_in = \"1933-04-21\"\n    AND C.doctor LIKE \"% Delorme\"",
    "formula": "salt_090(sum(C.hash) OVER()) AS token",
    "entry_token": "38613731426077"
  },
  {
    "kind": "context",
    "text": "En passant devant la buanderie de l'h√¥pital, le docteur Germain regarde machinalement par le carreau de la porte. Il aper√ßoit Marie Corbin qui sort une lettre de son enveloppe. Il fait irruption dans la pi√®ce.\n\n- Eh bien, ne vous g√™nez pas ! Donnez-moi √ßa.\n\nIl prend la lettre et la d√©chire.\n\n- Vous laissez tout un tas de paperasse dans vos poches, se d√©fend l'infirmi√®re. Il faut bien que je change votre correspondance de blouse si vous ne voulez pas qu'elle aille √† l'√©tuve.\n- Je ne vous demande pas de la lire.\n- Et moi, je ne vous demande pas pourquoi vous √©crivez √† ma s≈ìur, r√©pond-elle sans se d√©monter.\n- Vous √™tes charg√©e de la surveiller¬†?\n- Ce que j'en dis, c'est pour vous¬†: Laura est une petite vip√®re.  \n- Pas pendant le service, voulez-vous¬†?\n\nEt, changeant de sujet¬†:\n\n- Le 13 se plaint de ne pas dormir."
  },
  {
    "kind": "question",
    "text": "Pourquoi Fran√ßois Boulin n'arrive-t-il pas √† dormir¬†? Vous le saurez en listant les sp√©cialit√©s que Germain lui a prescrites, mais qui ne sont pas ou plus disponibles √† la pharmacie. Vous projetterez √©galement le stock correspondant. <br>_Aide._ La table `prescription` a pour cl√© primaire deux cl√©s √©trang√®res, l'une vers la table `consultation`, l'autre vers la table `speciality`. Celle-ci r√©pertorie les diff√©rentes ¬´¬†sp√©cialit√©s¬†¬ª (ou m√©dicaments), avec √©ventuellement leur stock en pharmacie.",
    "query": "SELECT A.speciality, A.stock\nFROM consultation B\nJOIN prescription C USING (consultation)\nJOIN speciality A USING (speciality)\nWHERE B.patient = \"Fran√ßois Boulin\"\n    AND B.doctor = \"R√©my Germain\"\n    AND (A.stock = 0\n         OR A.stock IS NULL)",
    "formula": "salt_099(sum(A.hash + B.hash + C.hash) OVER()) AS token",
    "entry_token": "4759373510280",
    "output_token": "1214408487456300"
  },
  {
    "kind": "hint",
    "text": "Incluez √©galement les sp√©cialit√©s qui n'ont pas lieu d'√™tre stock√©es en pharmacie (`NULL`).",
    "query": "SELECT A.speciality, A.stock\nFROM consultation B\nJOIN prescription C USING (consultation)\nJOIN speciality A USING (speciality)\nWHERE B.patient = \"Fran√ßois Boulin\"\n    AND B.doctor = \"R√©my Germain\"\n    AND A.stock = 0",
    "formula": "salt_099(sum(A.hash + B.hash + C.hash) OVER()) AS token",
    "entry_token": "712432571142668"
  },
  {
    "kind": "hint",
    "text": "Certaines de ces sp√©cialit√©s ne lui ont pas √©t√© prescrites par le docteur Germain.",
    "query": "SELECT A.speciality, A.stock\nFROM consultation B\nJOIN prescription C USING (consultation)\nJOIN speciality A USING (speciality)\nWHERE B.patient = \"Fran√ßois Boulin\"\n    AND (A.stock = 0\n         OR A.stock IS NULL)",
    "formula": "salt_099(sum(A.hash + B.hash + C.hash) OVER()) AS token",
    "entry_token": "1836392672107944"
  },
  {
    "kind": "hint",
    "text": "Il s'agit l√† de toutes les sp√©cialit√©s qui ont √©t√© prescrites √† Fran√ßois Boulin, pas forc√©ment par le docteur Germain. De plus, certaines son disponibles en pharmacie.",
    "query": "SELECT S.speciality, S.stock\nFROM consultation C\nJOIN prescription P USING (consultation)\nJOIN speciality S USING (speciality)\nWHERE C.patient = \"Fran√ßois Boulin\"",
    "formula": "salt_099(sum(S.hash) OVER()) AS token",
    "entry_token": "671403540618809"
  },
  {
    "kind": "hint",
    "text": "Il s'agit l√† de toutes les sp√©cialit√©s qui ont √©t√© prescrites √† Fran√ßois Boulin par le docteur Germain, y compris celles qui ne sont pas ou plus en stock.",
    "query": "SELECT S.speciality, S.stock\nFROM consultation C\nJOIN prescription P USING (consultation)\nJOIN speciality S USING (speciality)\nWHERE C.patient = \"Fran√ßois Boulin\"\n    AND C.doctor = \"R√©my Germain\"",
    "formula": "salt_099(sum(S.hash) OVER()) AS token",
    "entry_token": "268723976151153"
  },
  {
    "kind": "hint",
    "text": "Vous devez utiliser la table `speciality` dans le calcul du code. V√©rifiez √©galement que vous projetez bien le stock comme demand√©.",
    "query": "SELECT P.speciality\nFROM consultation C\nJOIN prescription P USING (consultation)\nJOIN speciality S USING (speciality)\nWHERE C.patient = \"Fran√ßois Boulin\"\n    AND C.doctor = \"R√©my Germain\"\n    AND (S.stock = 0\n         OR S.stock IS NULL)",
    "formula": "salt_099(sum(P.hash) OVER()) AS token",
    "entry_token": "493210324927682"
  },
  {
    "kind": "context",
    "text": "- Le 13 ? dit Marie Corbin... Ah¬†! le cancer du foie ? Bah, il en a pour quinze jours, et encore...  \n- Vous lui donnez bien sa morphine ?  \n- √Ä quoi bon ? Je lui en ai donn√© le premier jour, il ne s'en est m√™me pas aper√ßu.  \n- Je ne vous ai pas dit d'arr√™ter la s√©rie¬†!\n- Je lui mets de l'eau distill√©e, √ßa lui fait le m√™me effet.\n- Malheureusement pour vous, je viens de la pharmacie¬†: toutes les ampoules ont disparu. J'ignore si vous les employez √† votre usage personnel ou si vous les revendez, mais il faudra les retrouver avant demain matin !  \n- √âcoutez, docteur...\n- Non¬†! Demain matin.  \n\nIl sort de l'h√¥pital pour rentrer chez lui."
  },
  {
    "kind": "question",
    "text": "Pour chaque habitant de l'√©cole, donnez son adresse compl√®te (incluant le compl√©ment, qui va donner l'appartement) et sa profession (ou `NULL` s'il est sans profession). <br>_Aide._ La table `structure` r√©pertorie les √©tablissements employant des gens de Saint-Robin. Vous y trouverez des adresses similaires √† celles de `person` (mais sans compl√©ment d'adresse).",
    "query": "SELECT person, name, complement, num, street\nFROM person A\nLEFT JOIN job B USING(job)\nJOIN structure C USING(num, street)\nWHERE C.structure = \"√©cole\"",
    "formula": "salt_013(sum(nn(A.hash) + nn(B.hash) + nn(C.hash)) OVER()) AS token",
    "entry_token": "1214408487456300",
    "output_token": "3600096053250317"
  },
  {
    "kind": "hint",
    "text": "On peut habiter √† l'√©cole sans y travailler.",
    "query": "SELECT person, name, complement, num, street\nFROM person A\nLEFT JOIN job B USING(job)\nJOIN structure C USING(num, street)\nWHERE C.structure = \"√©cole\"\n    AND B.structure = \"√©cole\"",
    "formula": "salt_013(sum(nn(A.hash) + nn(B.hash) + nn(C.hash)) OVER()) AS token",
    "entry_token": "2454572954327419"
  },
  {
    "kind": "hint",
    "text": "Vous n'avez pas pens√© aux habitants sans profession. Utilisez `LEFT JOIN`.",
    "query": "SELECT person, name, complement, num, street\nFROM person A\nJOIN job B USING(job)\nJOIN structure C USING(num, street)\nWHERE C.structure = \"√©cole\"",
    "formula": "salt_013(sum(nn(A.hash) + nn(B.hash) + nn(C.hash)) OVER()) AS token",
    "entry_token": "3326670261982068"
  },
  {
    "kind": "hint",
    "text": "Faites la jointure sur l'adresse compl√®te, donc sur `street` en plus de `num`.",
    "query": "SELECT person, name, complement, num, A.street\nFROM person A\nLEFT JOIN job B USING(job)\nJOIN structure C USING(num)\nWHERE C.structure = \"√©cole\"",
    "formula": "salt_013(sum(nn(A.hash) + nn(B.hash) + nn(C.hash)) OVER()) AS token",
    "entry_token": "3864189421279361"
  },
  {
    "kind": "hint",
    "text": "Faites la jointure sur l'adresse compl√®te, donc sur `num` en plus de `street`.",
    "query": "SELECT person, name, complement, A.num, street\nFROM person A\nLEFT JOIN job B USING(job)\nJOIN structure C USING(street)\nWHERE C.structure = \"√©cole\"",
    "formula": "salt_013(sum(nn(A.hash) + nn(B.hash) + nn(C.hash)) OVER()) AS token",
    "entry_token": "5964990561272743"
  },
  {
    "kind": "context",
    "text": "√Ä la grille, le directeur de l'√©cole, No√´l Saillens, accueille les enfants qui reviennent pour les classes de l'apr√®s-midi.\n\n- Bonjour M. le directeur, dit un petit en mordant dans une tartine.\n- Bonjour, Philippe. Tu n'as donc pas d√©jeun√© ?\n- Si, monsieur.\n- Alors, qu'est-ce que tu fais ?\n- Je commence √† go√ªter !\n\nLe directeur sourit. Il avise M. Germain qui passe devant la grille.\n\n- Ah¬†! docteur ! Excusez-moi...\n- Je vous en prie...\n- J'ai quelqu'un de malade chez moi.\n- Rolande ?\n- Non, ma s≈ìur.\n- Ah ?\n- En montant chez vous, vous pourriez peut-√™tre frapper √† sa porte. √áa ne vous ennuie pas ?\n- Pas du tout. Je suis m√©decin.\n\nD'un coup de poing, Germain renvoie un ballon qui a manqu√© de faire tomber son chapeau.\n\n- Dis donc, toi¬†! Tu veux que j'aille te tirer les oreilles ?\n- Eh bien, Fernand, fais un peu attention¬†!\n\nEt, √† l'intention du docteur¬†:\n\n- Ils sont jeunes...\n- Ouais...\n- Vous n'aimez pas les enfants ?\n- Pas trop.\n- Et vous √™tes venu habiter chez un directeur d'√©cole !\n- Le destin !\n\nEn arrivant √† la porte, celle-ci s'ouvre devant lui.\n\n- Alors, Rolande, vous jouez la concierge ?\n\nC'est la fille du directeur. L'adolescente baisse les yeux derri√®re ses grosses lunettes.\n\n- Non, docteur. Je me trouvais l√†... par hasard, et... je vous ai vu venir.\n- Votre tante est malade ?\n- Denise ? Ouais... Il para√Æt, r√©pond-elle avec un air plein de sous-entendus.\n\nGermain prend l'escalier.\n\n- Ah¬†! Docteur, lui crie-t-elle. On a apport√© une lettre pour vous ce matin. Je l'ai laiss√©e sur votre bureau. Il n'y a pas de nom d'exp√©diteur.\n- Merci."
  },
  {
    "kind": "question",
    "text": "Rolande habite en face de son lieu de travail. Dressez la liste de toutes les personnes qui sont dans le m√™me cas (on consid√©rera que deux b√¢timents de la m√™me rue se font face si leurs num√©ros diff√®rent de 1 ou 3). La table devra comporter les colonnes suivantes¬†: nom, √¢ge, adresse du domicile, travail, structure, adresse du travail. Chaque adresse consistera en la concat√©nation du num√©ro et de la rue. <br>_Aide._ Sous MySQL, la concat√©nation se fait avec une fonction `CONCAT()`.",
    "query": "SELECT person, age, concat(A.num, \" \", A.street) AS \"adresse domicile\", B.name AS travail, C.structure, concat(C.num, \" \", C.street) AS \"adresse travail\"\nFROM person A\nJOIN job B USING(job)\nJOIN structure C USING(structure)\nWHERE A.street = C.street\n    AND A.num - C.num in (-3, -1, 1, 3)",
    "formula": "salt_093(sum(A.hash + B.hash + C.hash) OVER()) AS token",
    "entry_token": "3600096053250317",
    "output_token": "1862182707925787"
  },
  {
    "kind": "hint",
    "text": "La jointure en `job` et `structure` doit se faire sur leur colonne commune (`structure`) pour que le r√©sultat contienne l'adresse du travail de la personne. Si vous faites la jointure sur l'adresse, vous avez juste les personnes qui habitent dans une rue o√π se trouve une structure.",
    "query": "SELECT P.person, P.complement, concat(P.num, \" \", P.street) AS adresse_domicile, J.name, J.structure, concat(S.num, \" \", S.street) AS adresse_travail\nFROM person P\nJOIN job J USING(job)\nJOIN structure S USING(street)\nWHERE S.num = (P.num - 3)\n    OR S.num = (P.num - 1)\n    OR S.num = (P.num + 1)\n    OR S.num = (P.num + 3)",
    "formula": "salt_093(sum(P.hash + J.hash + S.hash) OVER()) AS token",
    "entry_token": "7475515623733405"
  },
  {
    "kind": "hint",
    "text": "N'oubliez pas que le num√©ro du travail peut √™tre plus petit ou plus grand que celui du domicile.",
    "query": "SELECT person, age, concat(P.num, \" \", P.street) AS \"personal address\", J.name AS job, S.structure, concat(S.num, \" \", S.street) AS \"professional address\"\nFROM person P\nJOIN job J USING(job)\nJOIN structure S USING(structure)\nWHERE P.street = S.street\n    AND P.num - S.num in (1, 3)",
    "formula": "salt_093(sum(P.hash + J.hash + S.hash) OVER()) AS token",
    "entry_token": "1466519794090355"
  },
  {
    "kind": "hint",
    "text": "N'oubliez pas que le num√©ro de l'adresse du travail peut √™tre plus petit ou plus grand que celui du domicile.",
    "query": "SELECT person, age, concat(P.num, \" \", P.street) AS \"adresse domicile\", J.name AS travail, S.structure, concat(S.num, \" \", S.street) AS \"adresse travail\"\nFROM person P\nJOIN job J USING(job)\nJOIN structure S USING(structure)\nWHERE P.street = S.street\n    AND S.num - P.num in (1, 3)",
    "formula": "salt_093(sum(P.hash + J.hash + S.hash) OVER()) AS token",
    "entry_token": "499121154031788"
  },
  {
    "kind": "context",
    "text": "Note historique¬†: Rolande est employ√©e au guichet de la poste. En France, l'interdiction d'employer un enfant de moins de 16 ans remonte √† 1959. √Ä l'√©poque o√π se d√©roule notre r√©cit, l'√¢ge minimum √©tait de 14 ans.\n\nLe docteur frappe chez Denise Saillens.\n\n- Bonjour, mademoiselle.\n- Bonjour.\n\nLes cris des enfants qui jouent montent de la cour. Il va fermer la fen√™tre.\n\n- Vous pouvez la laisser ouverte, dit la jeune femme. L'air me fait du bien.\n- Ce n'est pas pour vous, c'est pour moi. Ces piaillements m'exasp√®rent... Vous vous parfumez ?\n- √áa ne vous pla√Æt pas ?\n- J'aurais d√ª laisser la fen√™tre ouverte. Alors ? D'o√π souffrez-vous ?\n- D'un peu partout. Je tousse, j'ai la fi√®vre et une esp√®ce de lassitude... Et comme un point dans le dos ! En haut et √† gauche.\n- Ici ?\n- Oui.\n- Ou l√† ?\n- C'est-√†-dire...\n- Peut-√™tre entre les deux ?\n- Peut-√™tre...\n- Je vais vous ausculter, d√©shabillez-vous. Le lainage, seulement. Respirez. Toussez. Encore. Dites 33.\n- 33¬†! 33¬†! 33 !\n- Moins fort.\n- 33. 33. 33.\n- Bon, √©tendez-vous. Vous avez un mouchoir ?\n- La chemise ne suffit pas ?\n- Non. Peu importe. Je prendrai le mien.\n\nIl √©tend le mouchoir sur la poitrine de Denise, puis y colle son oreille.\n\n- Respirez. Encore... Normalement¬†! Respirez normalement.\n- Vous voyez ce que j'ai ?\n- Parfaitement.\n\nIl se redresse.\n\n- Vous n'avez rien.\n- Je ne suis pas malade, moi ?\n- Vous vouliez juste vous faire ausculter. Mais pour ce genre d'auscultation, ce n'est pas un m√©decin qu'il faut appeler. Pas moi en tout cas ! Au revoir, mademoiselle.\n- Joseph, va ! lui lance-t-elle au moment o√π il va sortir.\n- Je m'appelle R√©my.\n\n---\n\n_Note._ Denise fait une r√©f√©rence moqueuse √† Joseph, fils de Jacob, qui dans le r√©cit biblique repousse les avances de la femme d'un officier de Pharaon auquel il a √©t√© vendu comme esclave."
  },
  {
    "kind": "question",
    "text": "Quelles consultations (patient, date) du docteur Germain n'ont donn√© lieu au diagnostic d'aucun trouble¬†?",
    "query": "SELECT A.patient, A.date\nFROM consultation A\nLEFT JOIN diagnostic B USING(consultation)\nWHERE A.doctor = \"R√©my Germain\"\n    AND B.consultation IS NULL",
    "formula": "salt_033(sum(nn(A.hash) + nn(B.hash)) OVER()) AS token",
    "entry_token": "1862182707925787",
    "output_token": "751951002843097"
  },
  {
    "kind": "hint",
    "text": "Restreignez votre requ√™te aux consultations du docteur Germain.",
    "query": "SELECT A.patient, A.date\nFROM consultation A\nLEFT JOIN diagnostic B USING(consultation)\nWHERE B.consultation IS NULL",
    "formula": "salt_033(sum(nn(A.hash) + nn(B.hash)) OVER()) AS token",
    "entry_token": "1747224869146271"
  },
  {
    "kind": "context",
    "text": "En sortant de l'appartement, il rencontre Laura Vorzet qui monte rapidement l'escalier.\n\n- J'√©tais venue apporter des journaux de mode √† Denise.\n- Vous pouvez y aller.\n- Elle n'a rien de grave au moins ? Je ne vais pas la fatiguer ?\n- Rassurez-vous, vous ne la fatiguerez pas.\n\nElle frappe √† la porte.\n\n- C'est toi¬†? lui crie Denise. Entre¬†!\n\nLa main sur la poign√©e, la jeune femme semble se raviser.\n\n- Attendez, dit-elle au docteur. Je ne vais pas jouer la com√©die. C'est vous que je voulais voir. Les journaux de mode n'√©taient qu'un pr√©texte.\n- Mais... vous n'aviez pas besoin de pr√©texte.\n- Vous croyez ? Eh bien, vous vous trompez. C'√©tait peut-√™tre vrai hier, √ßa ne l'est plus aujourd'hui... Et par votre faute !\n- Par ma faute¬†? Je ne comprends pas.\n- Oh¬†! vous √™tes un ami r√©serv√©, docteur, tr√®s r√©serv√©. Mais il vous est sans doute arriv√© de dire ou de laisser dire quelque chose sur mon compte, n'est-ce pas ?\n- Moi ?\n- Il para√Æt que nous profitons de nos rencontres √† l'h√¥pital pour... pour prendre des rendez-vous secrets. On m'accuse d'√™tre votre ma√Ætresse.\n- Quoi¬†! Qui vous accuse ?\n- J'ai re√ßu au courrier de midi une lettre anonyme, une lettre ignoble. Vous comprendrez maintenant que je sois oblig√©e de vous √©viter.\n\nSur ces mots, elle entre chez Denise. Le docteur Germain est d√©contenanc√©. En bas, dans le hall, il aper√ßoit Rolande, toujours l√†, qui fait mine de jouer √† la balle. Il hausse les √©paules, et rentre chez lui.\n\nRolande monte l'escalier sur la pointe des pieds, colle son ≈ìil √† la serrure. Le docteur a trouv√© l'enveloppe sur son bureau. Il l'ouvre, lit la lettre et s'asseoit, p√©trifi√©."
  },
  {
    "kind": "question",
    "text": "Pour la lire √† votre tour, extrayez de la table `sentence` toutes les lignes dont l'identifiant est divisible par celui de la lettre re√ßue ce jour-l√† par le docteur Germain, et triez-les par identifiant d√©croissant. <br>_Aide._ La table `sentence` comporte l'ensemble des phrases des lettres du Corbeau, mais m√©lang√©es. Elle n'est pas directement li√©e au reste de la base, et ne peut √™tre exploit√©e que par des manipulations un peu ¬´¬†tordues¬†¬ª comme celle-ci, qui vous seront r√©v√©l√©es au fur et √† mesure. Ici, vous avez besoin de la fonction `MOD()`.",
    "query": "SELECT text\nFROM sentence A\nJOIN letter B ON(mod(A.sentence, B.letter) = 0)\nWHERE B.recipient = \"R√©my Germain\"\n    AND B.date = \"1933-04-21\"\nORDER BY sentence DESC",
    "formula": "salt_023(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "751951002843097",
    "output_token": "2034599770740825"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux lettres re√ßues ce jour-l√†, le 21 avril 1933.",
    "query": "SELECT text\nFROM sentence A\nJOIN letter B ON(mod(A.sentence, B.letter) = 0)\nWHERE B.recipient = \"R√©my Germain\"\nORDER BY sentence DESC",
    "formula": "salt_023(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "3309060536868495"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux lettres re√ßues par le docteur Germain.",
    "query": "SELECT text\nFROM sentence A\nJOIN letter B ON(mod(A.sentence, B.letter) = 0)\nWHERE B.date = \"1933-04-21\"\nORDER BY sentence DESC",
    "formula": "salt_023(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "5368519363376453"
  },
  {
    "kind": "context",
    "text": "Le lendemain matin, le docteur Michel Vorzet rentre d'un congr√®s de psychiatrie. La bonne lui ouvre la porte.\n\n- Bonjour, monsieur.\n- Bonjour, Raymonde.\n\nMme Vorzet para√Æt, une enveloppe √† la main.\n\n- Emportez les valises dans la chambre de monsieur.\n- Bien, madame.\n- Quel voyage ! s'exclame Vorzet en √¥tant son pardessus. Quoi de plus ridicule qu'un congr√®s de m√©decins ?... Si ce n'est un congr√®s de psychiatres, bien entendu ! Personne n'√©coute celui qui parle... Dieu merci¬†: pour prendre ces communications au s√©rieux, il faudrait un public de malades.\n\nEt, avec un clin d'≈ìil¬†:\n\n- Au fond, reprend-il, la seule utilit√© de ces manifestations, c'est de permettre aux m√©decins de province d'aller tromper leur femme avec les Parisiennes... Comme √ßa n'est plus de mon √¢ge, je suis rentr√©.\n\nMme Vorzet ne r√©agit pas.\n\n- Eh bien, Laura, qu'y a-t-il ? Qu'est-ce qui ne va pas¬†?\n- Michel, je t'ai parl√© de la lettre d'hier.\n- Oui, et apr√®s ?\n- Il y en a une pour toi aujourd'hui, dit-elle en lui tendant l'enveloppe.\n- Ah.\n\nIl d√©chire l'enveloppe, en extrait la lettre et la lit en silence."
  },
  {
    "kind": "question",
    "text": "Parmi les couples mari√©s, quelle est la diff√©rence d'√¢ge maximale en valeur absolue¬†? <br>_Aide._ Vous aurez besoin d'une auto-jointure (jointure d'une table avec elle-m√™me), pour mettre sur la m√™me ligne les √¢ges requis pour le calcul des diff√©rences.",
    "query": "SELECT max(abs(A.age - B.age)) AS \"maximum\"\nFROM person A\nJOIN relation C ON (A.person = person_1)\nJOIN person B ON (person_2 = B.person)\nWHERE nature = \"mari\"",
    "formula": "salt_091(üëÄ + sum(bit_xor(A.hash + B.hash + C.hash)) OVER ()) AS token",
    "tweak": "cette valeur",
    "entry_token": "2034599770740825",
    "output_token": "8346859713932946"
  },
  {
    "kind": "variant",
    "text": "Sym√©triquement.",
    "query": "SELECT max(abs(A.age - B.age)) AS \"maximum\"\nFROM person A\nJOIN relation C ON (A.person = person_1)\nJOIN person B ON (person_2 = B.person)\nWHERE nature = \"femme\"",
    "formula": "salt_091(üëÄ + sum(bit_xor(A.hash + B.hash + C.hash)) OVER ()) AS token",
    "entry_token": "7931782998365219",
    "redirection": "8346859713932946"
  },
  {
    "kind": "hint",
    "text": "La table `relation` est sym√©trique. Choisissez seulement la relation ¬´¬†mari¬†¬ª ou ¬´¬†femme¬†¬ª pour √©viter de faire deux fois les m√™mes calculs.",
    "query": "SELECT max(abs(A.age - B.age)) AS \"maximum\"\nFROM person A\nJOIN relation C ON (A.person = person_1)\nJOIN person B ON (person_2 = B.person)\nWHERE nature IN ('mari', 'femme')",
    "formula": "salt_091(üëÄ + sum(bit_xor(A.hash + B.hash + C.hash)) OVER ()) AS token",
    "entry_token": "16312692863708366"
  },
  {
    "kind": "context",
    "text": "Un peu plus tard dans la journ√©e, Germain, en traversant le parc pour retourner √† l'h√¥pital, voit un de ses confr√®res qui s'amuse √† nourrir les oiseaux avec des morceaux de pain tremp√©s dans du lait.\n\n- Bonjour, Vorzet. Je ne vous savais pas de retour.\n- Mon cher Germain, un vieux mari ne doit pas laisser longtemps seule sa jeune femme, r√©pond le psychiatre d'un air malicieux.\n- C'est pour moi que vous dites √ßa ?\n- Eh eh¬†! Pourquoi pour vous ? Je dis √ßa pour elle et pour moi. Ne vous f√¢chez pas¬†!\n\nGermain se mord les l√®vres.\n\n- Vous aimez les oiseaux¬†? reprend-il.\n- Ils m'int√©ressent. Ils sont plus intelligents qu'on ne croit. Je suis un peu ornithologue √† mes heures, voyez-vous... Ah, √† propos d'oiseaux...\n- Oui¬†?\n- Figurez-vous que ma femme a re√ßu hier une lettre sign√©e d'un certain Corbeau. \n- Elle vous l'a dit ?\n- Oui, oh¬†! elle ne me cache rien. C'est le b√©n√©fice de mon grand √¢ge, eh eh¬†! Et d'ailleurs, j'ai re√ßu moi-m√™me ce matin... une seconde lettre.\n- Sur le m√™me sujet ?\n- Oui. Avec des d√©tails suppl√©mentaires... Il para√Ætrait que vos relations avec Laura auraient laiss√© des traces f√¢cheuses.\n- Quoi¬†?\n- Ne vous √©nervez pas !... Et que vous auriez profit√© de mon absence pour les faire dispara√Ætre... chirurgicalement.\n- Oh, le...\n- Eh... oui, que voulez-vous. Et j'ajoute que Delorme a re√ßu en tant que m√©decin-chef un torchon du m√™me genre. On vous accuse de d√©livrer les faibles femmes d'un fardeau encombrant. Voil√†, vous √™tes pr√©venu.\n- Si je connaissais le salaud...\n- Tout de suite les grands mots. Mon cher, j'ai la chance de conna√Ætre assez bien la question. J'ai √©t√© nomm√© plusieurs fois expert dans des affaires de lettres anonymes. Croyez-moi, nous ne sommes pas en pr√©sence d'un salaud, mais d'un malade.\n- Eh bien, je me charge de le soigner !\n- Quand vous l'aurez d√©couvert¬†!\n\nEt, d√©signant tour √† tour quelques visiteurs du parc¬†:\n\n- C'est peut-√™tre M. le substitut qui passe avec un mandat √† la main. Ou M. Fayolle qui lit le journal en marchant... N'est-ce pas, M. Fayolle ?\n- Pardon ?\n- Je dis, c'est peut-√™tre vous...\n- Qui fait quoi ?\n- Chut !... C'est un secret !\n- Ah, toujours le mot pour rire, docteur ! dit Fayolle en s'√©loignant.\n- Et si ce n'est ni Fayolle, ni le substitut, c'est peut-√™tre le docteur Germain lui-m√™me...\n- Vous me soup√ßonnez, moi, la victime de ce malade ?\n- Un malade peut fort bien s'accuser lui-m√™me. C'est fr√©quent chez les anonymographes. Remarquez, je ne vous crois pas coupable... pour le moment.\n- Vous √™tes trop bon...\n- Seulement il faut vous m√©fier. Ouvrir l‚Äô≈ìil. Quand ce genre de maladie se d√©clare, on ne sait pas o√π elle s'arr√™te. Toute une ville peut en √™tre atteinte. Au revoir, Germain.\n- Au revoir.\n\nIl s'est √† peine √©loign√© de quelques pas, qu'une id√©e lui traverse l'esprit.\n\n- Dites donc¬†! lance-t-il √† son confr√®re... Au fond, le corbeau, c'est peut-√™tre vous !\n- Et pourquoi pas ? r√©pond Vorzet.\n\nNote historique¬†: En France, l'avortement a longtemps √©t√© passible de la prison, des travaux forc√©s √† perp√©tuit√©, voire de la peine de mort. √Ä l'√©poque, environ 300 personnes par an √©taient condamn√©es pour ce motif. Mais malgr√© tous les risques encourus, le nombre de femmes qui recouraient √† un avortement clandestin √©tait de l'ordre de 500 000 par an. De nos jours, en d√©pit de la l√©galisation de l'IVG, mais avec la ¬´¬†pilule¬†¬ª, ce chiffre a diminu√© de moiti√©."
  },
  {
    "kind": "question",
    "text": "Combien de lettres anonymes ont √©t√© re√ßues jusqu'√† ce jour (22 avril 1933)¬†?",
    "query": "SELECT count(*) AS letters\nFROM letter A\nWHERE date <= \"1933-04-22\"",
    "formula": "salt_091(sum(A.hash) + count(*) OVER ()) AS token",
    "entry_token": "8346859713932946",
    "output_token": "928210439336594"
  },
  {
    "kind": "hint",
    "text": "On ne s'int√©resse qu'aux lettres re√ßues jusqu'au 22 avril 1933.",
    "query": "SELECT count(*) AS letters\nFROM letter A",
    "formula": "salt_091(sum(A.hash) + count(*) OVER ()) AS token",
    "entry_token": "116048926874326159"
  },
  {
    "kind": "hint",
    "text": "On s'int√©resse aux lettres re√ßues jusqu'au 22 avril 1933 inclus.",
    "query": "SELECT count(*) AS letters\nFROM letter A\nWHERE date < \"1933-04-22\"",
    "formula": "salt_091(sum(A.hash) + count(*) OVER ()) AS token",
    "entry_token": "298433104406685"
  },
  {
    "kind": "hint",
    "text": "On s'int√©resse aux lettres re√ßues jusqu'au 22 avril 1933 et non pas √† celles re√ßues seulement ce jour-l√†.",
    "query": "SELECT count(*) AS letters\nFROM letter A\nWHERE date = \"1933-04-22\"",
    "formula": "salt_091(sum(A.hash) + count(*) OVER ()) AS token",
    "entry_token": "666164991095780"
  },
  {
    "kind": "context",
    "text": "Quatre jours se sont √©coul√©s. Nous sommes maintenant le 26 avril 1933. Le directeur de l'h√¥pital, Antoine Delorme, entre dans le bureau du comptable, Henri Bonnevie.\n\n- Ah, M. le m√©decin-chef !\n- Restez assis...\n\nLui-m√™me reste debout.\n\n- Mon cher Bonnevie, je suis tr√®s emb√™t√©.\n- Rien de grave, j'esp√®re ?\n- J'ai encore re√ßu une lettre anonyme.\n- Encore ?\n- Et celle-ci ne met pas seulement Germain en cause. Je vais vous la lire.\n- Je vous en prie. J'en serais tr√®s honor√©.\n- ¬´¬†ùïçùïÄùîºùïÄùïÉ ùïÄùïç‚ÑùùïÜùîæ‚Ñïùîº¬†¬ª, commence le docteur... Hum, c'est une clause de style, naturellement.\n- Naturellement !"
  },
  {
    "kind": "question",
    "text": "Pour conna√Ætre la suite de cette lettre, joignez les tables `sentence` et `consultation` sur leurs identifiants, en ne gardant que les neuf consultations les plus r√©centes du docteur Delorme. <br>_Aide._ Utilisez la clause `ORDER BY` pour trier les dates, et `LIMIT` pour n'afficher que le nombre de lignes voulu.",
    "query": "SELECT B.text\nFROM consultation A\nJOIN sentence B ON (consultation = sentence)\nWHERE doctor = \"Antoine Delorme\"\n    AND date <= \"1933-04-27\"\nORDER BY date DESC\nLIMIT 9",
    "formula": "salt_078(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "928210439336594",
    "output_token": "7636881732328396"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux consultations qui se sont d√©roul√©es jusqu'au 27 avril 1933 maximum.",
    "query": "SELECT S.text\nFROM consultation C\nJOIN sentence S ON (consultation = sentence)\nWHERE doctor = \"Antoine Delorme\"\nORDER BY date DESC\nLIMIT 9",
    "formula": "salt_078(sum(C.hash + S.hash) OVER()) AS token",
    "entry_token": "10859409909177349"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux consultations du docteur Delorme.",
    "query": "SELECT S.text\nFROM consultation C\nJOIN sentence S ON (consultation = sentence)\nWHERE date <= \"1933-04-27\"\nORDER BY date DESC\nLIMIT 9",
    "formula": "salt_078(sum(C.hash + S.hash) OVER()) AS token",
    "entry_token": "10066030021317694"
  },
  {
    "kind": "hint",
    "text": "Restreignez le r√©sultat aux consultations du docteur Delorme jusqu'√† ce jour.",
    "query": "SELECT S.text\nFROM consultation C\nJOIN sentence S ON (consultation = sentence)\nORDER BY date DESC\nLIMIT 9",
    "formula": "salt_078(sum(C.hash + S.hash) OVER()) AS token",
    "entry_token": "14980914644183631"
  },
  {
    "kind": "context",
    "text": "- Qu'en pensez-vous, Bonnevie ?\n- Et vous, M. le m√©decin-chef ?\n- Eh bien, pour vous dire la v√©rit√©, je suis emb√™t√©. Tr√®s emb√™t√©. √áa pose v√©ritablement un cas de conscience ! Vous me comprenez ?\n- Je vous comprends, et d'autant plus que je me trouve moi-m√™me confront√© √† pareil cas de conscience.\n- Non ? dit Delorme en s'asseyant.\n- J'ai moi aussi re√ßu une lettre anonyme. Et je vous demande la permission de vous en donner lecture.\n- Mais, je pense bien, allez-y, mon cher.\n\nL'√©conome se l√®ve, et vient s'appuyer sur le coin de son bureau, juste au-dessus de Delorme.\n\n- ¬´¬†ùïçùïÄùîºùïÄùïÉùïÉùîº ‚ÑÇùî∏‚Ñïùî∏ùïÄùïÉùïÉùîº¬†¬ª, commence-t-il... Hum, c'est une clause de style, naturellement.\n- Naturellement¬†!"
  },
  {
    "kind": "question",
    "text": "Pour conna√Ætre la suite de cette lettre, convertissez en binaire la somme des identifiants des m√©tiers des filles d'Henri Bonnevie, et extrayez de la table `sentence` toutes les lignes dont l'identifiant en binaire se termine par les m√™mes chiffres. <br>_Aide._ Utilisez la fonction `CONV(nombre_√†_convertir, base_de_d√©part, base_d'arriv√©e)` qui renvoie une cha√Æne de caract√®res, ainsi que la fonction `CONCAT()` et l'op√©rateur `LIKE`.",
    "query": "SELECT text\nFROM sentence A\nWHERE conv(sentence, 10, 2) LIKE\n        (SELECT concat(\"%\", conv(sum(job), 10, 2))\n         FROM relation R\n         JOIN person P ON (person_1 = person)\n         WHERE nature = \"fille\"\n             AND person_2 = \"Henri Bonnevie\" )",
    "formula": "salt_010(sum(A.hash) OVER()) AS token",
    "entry_token": "7636881732328396",
    "output_token": "872515681869408"
  },
  {
    "kind": "context",
    "text": "- Qu'est-ce que vous pensez de √ßa¬†? demande Bonnevie en finissant la lecture.\n\nLe m√©decin-chef s'est d√©compos√©.\n\n- D√©cid√©ment, ces lettres sont un tissu de mensonges et de calomnies. Mon opinion est faite, dit-il en lui serrant la main.\n- La mienne aussi, M. le m√©decin-chef.\n\nQuand son sup√©rieur a quitt√© le bureau, il s'√©ponge le front.\n\n------------------------\n\n√Ä la fin de la journ√©e, au Cercle, le caf√© o√π les notables de Saint-Robin ont leurs habitudes.\n\n- Bonsoir, M. le maire.\n- M. le comte...\n- Bonsoir.\n- Bonsoir, mon ami.\n- Alors, on ne joue pas ?\n- Non, ces messieurs discutent.\n- Fayolle a re√ßu une lettre.\n- Moi aussi, dit le maire. Et c'est plus grave.\n- Pourquoi plus grave ?\n- Parce que je suis un homme public, M. Fayolle¬†! Preuve que le coupable n'a m√™me pas le respect des fonctions officielles ! Triste nature !\n\nIl s'asseoit, sort une lettre de sa poche.\n\n- Tenez¬†! √©coutez-moi √ßa¬†: ¬´¬†ùïçùïÄùîºùïÄùïÉ ùîºùïÑùîπùïåùïä‚Ñöùïå√â¬†¬ª, commence-t-il...\n\nQuelqu'un √©touffe un rire.\n\n- J'ai fait justice de cette √¢nerie pendant ma campagne √©lectorale. ¬´¬†ùïãùïå ùî∏ùîªùïÑùïÄ‚ÑïùïÄùïäùïã‚Ñùùîºùïä ùïå‚Ñïùîº ùïçùïÄùïÉùïÉùîº ‚ÑôùïÜùïå‚Ñù‚ÑùùïÄùîº, ùîºùïã ‚ÑôùïÜùïå‚Ñù‚ÑùùïÄùîº ‚Ñôùî∏‚Ñù ùîæùîº‚ÑùùïÑùî∏ùïÄ‚Ñï, ùïÉùîº ùïäùïÜùïÑùîπ‚Ñùùîºùïå‚Ñù ùîªùîº ‚ÑôùïÜùïÉùïÄ‚ÑÇ‚ÑçùïÄ‚ÑïùîºùïÉùïÉùîºùïä. ùïçùïÜùïÄ‚ÑÇùïÄ ùïÑùïÜ‚Ñï ‚Ñù√â‚ÑöùïåùïÄùïäùïÄùïãùïÜùïÄ‚Ñùùîº ùîº‚Ñï ùïã‚ÑùùïÜùïÄùïä ‚ÑôùïÜùïÄ‚Ñïùïãùïä¬†: ‚Ñô‚ÑùùïÄùïÑùïÜ, ùîæùîº‚ÑùùïÑùî∏ùïÄ‚Ñï ùî∏ ùîΩùî∏ùïÄùïã ùïÉùîºùïä ‚Ñöùïåùî∏ùïã‚Ñùùîº ‚ÑÇùîº‚Ñïùïãùïä ‚ÑÇùïÜùïå‚Ñôùïä ùî∏ùïçùîº‚ÑÇ¬†¬ª...\n\nIl jette un coup d'≈ìil au docteur Vorzet qui joue au billard √† l'autre bout de la salle.\n\n- Ici, continue-t-il, le nom d'une dame honorablement connue de la soci√©t√©. Inutile de dire le cas qu'il faut faire d'une semblable assertion. ¬´¬†ùïäùîº‚ÑÇùïå‚ÑïùîªùïÜ, ùîæùîº‚ÑùùïÑùî∏ùïÄ‚Ñï ùïã‚Ñùùî∏ùîΩùïÄ‚Ñöùïåùîº ùîªùîº ùïÉùî∏ ùïÑùïÜ‚Ñù‚Ñô‚ÑçùïÄ‚Ñïùîº, ùîºùïã ‚ÑÇ‚Ñçùîº‚Ñù‚ÑÇ‚Ñçùîº √Ä ùîΩùî∏ùïÄ‚Ñùùîº ùî∏‚ÑÇ‚ÑÇùïåùïäùîº‚Ñù ùïå‚Ñïùîº ùïçùïÄ‚ÑÇùïãùïÄùïÑùîº ùïÄ‚Ñï‚ÑïùïÜ‚ÑÇùîº‚Ñïùïãùîº, ùïÑùî∏‚ÑùùïÄùîº ‚ÑÇùïÜ‚ÑùùîπùïÄ‚Ñï, ‚Ñöùïåùîº ùïÅùîº ùïäùî∏ùïÉùïåùîº ‚Ñùùîºùïä‚Ñôùîº‚ÑÇùïãùïåùîºùïåùïäùîºùïÑùîº‚Ñïùïã.¬†¬ª Alors, qu'en pensez-vous ?\n- Et tertio ? demande le docteur Bertrand.\n- Tertio ? Sans importance.\n- Tertio, tu es cocu !\n\nLe maire foudroie le docteur Bertrand du regard.\n\n- Qu'en savez-vous ?\n- J'ai moi aussi re√ßu une lettre anonyme.\n- Hum¬†! Ce ne sont que des mensonges, mais c'est bien d√©sagr√©able.\n- Je ne suis pas de votre avis.\n- Vous trouvez √ßa agr√©able ?\n- Non, je parle des mensonges. Il semble que ces lettres contiennent un fond de v√©rit√©.\n- Charmant¬†! s'insurge le pharmacien. Alors je vendrais des m√©dicaments truqu√©s ?\n- Il ne s'agit pas de vous, r√©pond Bertrand. il s'agit du principal accus√©... Celui dont le nom figure dans chaque missive. Je ne me permettrais pas de dire du mal d'un de mes confr√®res, mais... j'ai eu l'autre matin avec lui une conversation qui m'a f√¢cheusement impressionn√©.\n\n√Ä une autre table, un jeune homme discute avec le docteur Delorme.\n\n- Depuis trois ans que je suis substitut, c'est la premi√®re fois qu'une affaire int√©ressante se pr√©sente. Je ne vais pas la rater.\n- On ne va pas arr√™ter Germain sans preuves.\n- Il ne s'agit pas d'arr√™ter. Il s'agit de mener une enqu√™te √† l'h√¥pital.\n- Ah non ! Non, jamais de la vie ! je m'y oppose formellement ! Assez d'histoires, hein¬†!\n- Un m√©decin-chef ne peut entraver l'action du parquet.\n- Non, mais ton p√®re peut te foutre une paire de claques si tu l'emmerdes !\n- Tu le prends comme √ßa ?\n- Parfaitement !\n- Bien, papa. Mais je sais o√π est mon devoir...\n\nVourzet a entendu la fin de leur conversation¬†:\n\n- Jeune homme, dit-il, vous n'avez qu'un devoir¬†: la prudence. Notre ville a la fi√®vre... Et on n'op√®re pas un malade √† chaud !"
  },
  {
    "kind": "question",
    "text": "Quel pourcentage de la population de Saint-Robin aura √©t√© destinataire d'une ou plusieurs lettres du Corbeau jusqu'√† ce mercredi 26 avril 1933¬†?",
    "query": "SELECT concat(100 * count(DISTINCT recipient) / count(DISTINCT person), \" %\") AS pourcentage\nFROM person A\nLEFT JOIN letter B ON (person = recipient\n                       AND date <= \"1933-04-26\")",
    "formula": "salt_029(üëÄ + sum(bit_xor(nn(A.hash) + nn(B.hash))) OVER ()) AS token",
    "tweak": "la partie d√©cimale de ce pourcentage",
    "entry_token": "872515681869408",
    "output_token": "41346104857895363"
  },
  {
    "kind": "variant",
    "text": "Avec produit cart√©sien.",
    "query": "SELECT concat(100 * count(DISTINCT B.recipient) / count(DISTINCT A.person), \" %\") AS pourcentage\nFROM person A, letter B\nWHERE date <= \"1933-04-26\"",
    "formula": "salt_029(üëÄ + sum(bit_xor(nn(A.hash) + nn(B.hash))) OVER ()) AS token",
    "entry_token": "1001705276796452248",
    "redirection": "41346104857895363"
  },
  {
    "kind": "hint",
    "text": "La date doit √™tre incluse.",
    "query": "SELECT concat(100 * count(DISTINCT A.recipient) / count(DISTINCT B.person), \" %\") AS pourcentage\nFROM person B\nLEFT JOIN letter A ON (B.person = A.recipient\n                       AND date < \"1933-04-26\")",
    "formula": "salt_029(üëÄ + sum(bit_xor(nn(A.hash) + nn(B.hash))) OVER ()) AS token",
    "entry_token": "40475478273398659"
  },
  {
    "kind": "hint",
    "text": "La date doit √™tre incluse.",
    "query": "SELECT concat(100 * count(DISTINCT B.recipient) / count(DISTINCT A.person), \" %\") AS pourcentage\nFROM person A, letter B\nWHERE date < \"1933-04-26\"",
    "formula": "salt_029(üëÄ + sum(bit_xor(nn(A.hash) + nn(B.hash))) OVER ()) AS token",
    "entry_token": "587110487732494548"
  },
  {
    "kind": "hint",
    "text": "La condition sur la date doit intervenir en condition de jointure (`ON`), faute de quoi les personnes non destinataires d'une lettre ne seront pas compt√©es dans le total.",
    "query": "SELECT concat(100 * count(DISTINCT B.recipient) / count(DISTINCT A.person), \" %\") AS pourcentage\nFROM person A\nLEFT JOIN letter B ON (A.person = B.recipient)\nWHERE date <= \"1933-04-26\"",
    "formula": "salt_029(üëÄ + sum(bit_xor(nn(A.hash) + nn(B.hash))) OVER ()) AS token",
    "entry_token": "3128514544378165"
  },
  {
    "kind": "context",
    "text": "Le lendemain, en d√©but d'apr√®s-midi, le directeur de l'√©cole entre dans la chambre de sa s≈ìur.\n\n- Denise, secoue-toi !\n- Laisse-moi dormir.\n- Ah non, cette fois √ßa suffit ! s'exclame-t-il en lui arrachant la couverture.\n- Mais, tu es fou¬†! Je suis malade ! hurle-t-elle.\n- Malade, toi ? Tu crois que je ne te connais pas ? Tous les locataires, tous, il te les a fallu ! Sauf le boy-scout et le vieux Frochard ! Et encore, je ne suis pas s√ªr pour le boy-scout. Maintenant, c'est le tour du docteur Germain !\n- Germain ? Oh l√† l√†¬†! On peut dire que tu as du go√ªt ! Il a l'air d'un parapluie ! Il doit faire l'amour comme un pion.\n- Alors pourquoi joues-tu la malade ?\n- Je ne joue pas la malade, je SUIS malade¬†! J'ai une bronchite ! Et une angine !\n- Attends... C'est vrai¬†? Tu as l'air vraiment malade... Tu as de la fi√®vre ? Fais voir ta gorge.\n\nIl lui soul√®ve le menton.\n\n- Qu'est-ce que c'est que √ßa ?\n- Une compresse.\n- Une compresse d'eau glac√©e ! Mes compliments¬†! En effet, tu ne joues pas la malade, tu te rends malade ! Et dire que j'ai failli me faire avoir ! Heureusement qu'une lettre m'a ouvert l‚Äô≈ìil !\n- Quelle lettre ?\n- Celle-ci ! dit-il en lui flanquant une paire de gifles."
  },
  {
    "kind": "question",
    "text": "Combien le 18 rue de la mairie a-t-il compt√© de locataires de sexe masculin, au maximum¬†? On supposera pour simplifier que tous les anciens amants de Denise r√©sident encore √† Saint-Robin. <br>_Aide._ La table `lovers` se concentre sur les relations ill√©gitimes entre personnages. Au contraire de `relation`, elle ne comporte pas de doublons par sym√©trie. Notez le pluriel dans le nom de la table¬†: chaque ligne comporte deux amants.",
    "query": "SELECT count(*) AS locataires\nFROM lovers A\nWHERE \"Denise Saillens\" in (person_1, person_2)",
    "formula": "salt_086(sum(A.hash) + count(*) OVER()) AS token",
    "entry_token": "41346104857895363",
    "output_token": "5640579605849479"
  },
  {
    "kind": "hint",
    "text": "Au contraire de la table `relation`, la table `lovers` ne comporte pas de doublons par sym√©trie. Le premier nom se trouve toujours avant le second par ordre alphab√©tique.",
    "query": "SELECT count(*) AS locataires\nFROM lovers A\nWHERE \"Denise Saillens\" = person_1",
    "formula": "salt_086(sum(A.hash) + count(*) OVER()) AS token",
    "entry_token": "4104734861329815"
  },
  {
    "kind": "hint",
    "text": "Au contraire de la table `relation`, la table `lovers` ne comporte pas de doublons par sym√©trie. Le premier nom se trouve toujours avant le second par ordre alphab√©tique.",
    "query": "SELECT count(*) AS locataires\nFROM lovers A\nWHERE \"Denise Saillens\" = person_2",
    "formula": "salt_086(sum(A.hash) + count(*) OVER()) AS token",
    "entry_token": "1765027710599052"
  },
  {
    "kind": "context",
    "text": "Dans la chambre de Denise. La jeune femme est toujours alit√©e, √† plat ventre, dos d√©couvert. Sa ni√®ce Rolande lui applique des ventouses.\n\n- Tu crois que c'est vrai ? dit celle-ci.\n- Quoi ?\n- Les choses qu'on raconte sur M. Picard... Il aurait fait un enfant √†...\n- √áa suffit, Rolande¬†! √áa ne te regarde pas. Ce ne sont pas des histoires pour les gamines.\n- Oh, la barbe¬†! Tu ne te rappelles plus quand tu avais mon √¢ge...\n- En tout cas, s'il y en a un qui a mauvaise presse, c'est le docteur Germain. Rien que cet apr√®s-midi, les oreilles ont d√ª lui tinter. Il va en baver¬†!\n- Tant mieux ! √áa lui apprendra.\n\nOn frappe √† la porte.\n\n- Va voir, souffle Denise.\n- Oh¬†! mais c'est le docteur, s'exclame Rolande en ouvrant... Bonsoir, docteur. Justement, nous parlions de vous, docteur...\n- Denise est malade ?\n- Oui, et cette fois, c'est pour de bon. Vous savez poser les ventouses ?\n- √Ä votre avis¬†?\n- Alors, prenez ma place, elle adore √ßa.\n\nRolande sort.\n\n- Vous √™tes enfin arriv√©e √† tomber malade...\n- Et apr√®s ? Si √ßa m'amuse de me rendre malade pour me faire soigner ?\n- Dr√¥le de fille !\n- Je ne sais pas qui est le plus dr√¥le des deux.\n- Oh¬†! moi, s√ªrement. Il faut √™tre dr√¥le pour ne pas se jeter sur la premi√®re femme qui s'offre, n'est-ce pas¬†?\n- Merci pour la premi√®re femme...\n\nIl applique une ventouse sur le dos de Denise en disant¬†:\n\n- Vous comprenez fort bien.\n- Je comprends que pour faire √ßa, il vous faut l'Amour avec une lettre majuscule.\n- Au contraire. Si je croyais aimer une femme, je m'enfuirais d'autant plus vite.\n- Dans ce cas, qu'est-ce qui vous emp√™che de prendre du plaisir quand il se trouve ?\n- Oh, presque rien... Un fant√¥me. Ou plut√¥t, deux fant√¥mes. Vous savez, Denise, je ne demande plus qu'une seule chose √† la vie : l'apaisement."
  },
  {
    "kind": "question",
    "text": "√Ä cette √©poque, un enfant dont les parents n'√©taient pas mari√©s ensemble √©tait dit ¬´¬†naturel¬†¬ª. Donnez la liste des enfants naturels, avec pour chacun son p√®re et sa m√®re.",
    "query": "SELECT R1.person_1 AS mother, R1.person_2 AS child, R2.person_1 AS father\nFROM relation R1\nJOIN relation R2 ON(R1.person_2 = R2.person_2)\nWHERE R1.nature = \"m√®re\"\n    AND R2.nature = \"p√®re\"\n    AND (R1.person_1, \"femme\", R2.person_1) not in\n        (SELECT person_1, nature, person_2\n         FROM relation A)",
    "formula": "salt_045(sum(R1.hash + R2.hash) OVER()) AS token",
    "entry_token": "5640579605849479",
    "output_token": "1291995708763182"
  },
  {
    "kind": "variant",
    "text": "Avec `LEFT JOIN`.",
    "query": "SELECT R1.person_1 AS mother, R1.person_2 AS child, R2.person_1 AS father\nFROM relation R1\nJOIN relation R2 ON (R1.person_2 = R2.person_2)\nLEFT JOIN relation R3 ON (R1.person_1 = R3.person_1\n                          AND R2.person_1 = R3.person_2)\nWHERE R1.nature = \"m√®re\"\n    AND R2.nature = \"p√®re\"\n    AND R3.nature IS NULL",
    "formula": "salt_045(sum(R1.hash + R2.hash) OVER()) AS token"
  },
  {
    "kind": "context",
    "text": "Rolande rouvre la porte.\n\n- Docteur, on vous demande¬†!\n- Moi¬†? Je reviens tout de suite, dit-il en ramenant le drap sur le dos de Denise.\n\nLe docteur Vorzet est √† sa porte.\n\n- Ah, c'est vous¬†! Vous me cherchiez¬†?\n- Oh, je passais... Et je me suis dit¬†: tiens, si nous allions faire une petite visite d'amiti√© √† notre bon docteur Germain¬†?\n- Entrez. Je passe devant, vous permettez¬†?\n\nLe psychiatre p√©n√®tre dans l'appartement.\n\n- Joli bureau Louis xv, f√©licitations !\n- Merci. Vous aimez les beaux meubles ?\n- Je les admire... de loin. Ce n'est pas avec les honoraires que nous recevons de nos concitoyens qu'on peut collectionner des pi√®ces de cette importance... Vous devez avoir une belle fortune personnelle...\n- Honn√™te.\n- Oui, c'est ce que je leur disais.\n- √Ä qui ?\n- Aux gens qui m'interrogeaient, tout √† l'heure.\n- Sur ma fortune ?\n- Oui, sur votre fortune. Enfin, plut√¥t, sur votre pass√©. Vous comprenez, avec cette malheureuse affaire, la curiosit√© s'est √©veill√©e...\n- La prochaine fois, envoyez-moi directement les curieux. Je les renseignerai moi-m√™me.\n- √Ä propos... Vous m'aviez dit qu'avant de venir ici vous exerciez √† Grenoble ?\n- Oui... Sans doute.\n- Un imb√©cile s'est avis√© de consulter l'annuaire m√©dical...\n- Et alors ?\n- Et alors, il n'a pas trouv√© de docteur Germain √† Grenoble.\n- Vous direz de ma part √† cet imb√©cile que la publication √† l'annuaire n'est pas obligatoire. C'est une simple affaire de publicit√©.\n- En fait, le seul Germain qui ait habit√© Grenoble, a quitt√© cette ville il y a quinze ans pour Paris. Il est devenu un fameux chirurgien du cerveau.\n- Barth√©l√©my Germain¬†? Je lui ai √©t√© pr√©sent√©.\n- Oh, c'est quelque chose¬†!... Son t√©moignage pourrait servir si on en arrivait √† une enqu√™te... Mais aujourd'hui, ils m'ont seulement demand√© de recueillir quelques renseignements.\n- Qui, ¬´¬†ils¬†¬ª ?\n- Eh bien, euh... d'autres imb√©ciles... Nous n'en manquons pas. Maintenant, je vous quitte. Il se fait tard.\n- Vous avez d√©couvert quelque chose sur le Corbeau ?\n- On accuse surtout ma belle-s≈ìur, Marie Corbin. Naturellement, elle a des griefs contre vous. Mais je ne la crois pas coupable. J'√©tais fianc√© avec Marie avant d'√©pouser Laura. Je la connais bien. Il faudrait qu'elle ait beaucoup chang√©...\n\nEt, sur le palier¬†:\n\n- Vous m'en voulez de ma visite ?\n- Au contraire. Je vous en remercie.\n- N'exag√©rez rien, tout de m√™me. Je vous souhaite de vivre vieux, Germain, mais de n'√™tre jamais le doyen du corps m√©dical. On nous impose des t√¢ches bien d√©sagr√©ables."
  },
  {
    "kind": "question",
    "text": "V√©rifiez que Vorzet est le doyen du corps m√©dical, en d'autres termes, qu'il est le plus vieux des employ√©s de l'h√¥pital.",
    "query": "SELECT person, age\nFROM person A\nJOIN job B USING(job)\nWHERE structure = \"h√¥pital\"\n    AND age =\n        (SELECT max(age)\n         FROM person\n         JOIN job USING(job)\n         WHERE structure = \"h√¥pital\" )",
    "formula": "salt_012(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "1291995708763182",
    "output_token": "122341303290277"
  },
  {
    "kind": "hint",
    "text": "L'id√©e n'est pas mauvaise, mais elle est moins g√©n√©rale¬†: il se peut qu'il y ait plusieurs personnes dont l'√¢ge est √©gal √† l'√¢ge maximal, et vous ne pouvez pas conna√Ætre leur nombre √† l'avance. Pour acc√©der √† l'√©tape suivante, vous devez employer la fonction d'agr√©gation `MAX()`.",
    "query": "SELECT person, age\nFROM person A\nJOIN job B USING(job)\nWHERE structure = \"h√¥pital\"\nORDER BY age DESC\nLIMIT 1",
    "formula": "salt_012(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "2055218539472369"
  },
  {
    "kind": "hint",
    "text": "Vous retournez la liste des doyens de la ville.",
    "query": "SELECT person, age\nFROM person A\nJOIN job B USING(job)\nWHERE age =\n        (SELECT max(age)\n         FROM person\n         JOIN job USING(job))",
    "formula": "salt_012(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "630983553121640"
  },
  {
    "kind": "hint",
    "text": "Vous retournez les personnes dont l'√¢ge est √©gal √† celui du doyen de l'h√¥pital, qu'elles y travaillent ou non.",
    "query": "SELECT person, age\nFROM person A\nJOIN job B USING(job)\nWHERE age =\n        (SELECT max(age)\n         FROM person\n         JOIN job USING(job)\n         WHERE structure = \"h√¥pital\" )",
    "formula": "salt_012(sum(A.hash + B.hash) OVER()) AS token",
    "entry_token": "432673484956197"
  },
  {
    "kind": "context",
    "text": "Le docteur Germain est sur le point de frapper chez Denise, quand celle-ci ouvre sa porte.\n\n- Je vous croyais au lit.\n- Je venais vous voir.\n- Chez moi ?\n- Vorzet ne se d√©place pas pour rien. C'est grave, n'est-ce pas ?\n- Qu'est-ce que √ßa peut vous faire ?\n- Toujours aimable...\n- Recouchez-vous, vous allez prendre froid.\n- Qu'est-ce que √ßa peut vous faire ?\n\nDenise retourne √† son lit, laisse tomber ses chaussures. Le docteur Germain ne peut s'emp√™cher de les observer. Denise a surpris son regard.\n\n- Oui, je boite. Et apr√®s ? Nous avons eu un accident de voiture, mon fr√®re et moi. Lui a perdu un bras, moi, j'ai attrap√© une coxalgie.\n\nElle se couche.\n\n- Est-ce que √ßa m'emp√™che d'√™tre belle femme ? Est-ce que √ßa emp√™che les hommes d'avoir envie de moi ? Est-ce que √ßa vous emp√™che d'avoir envie de moi ?\n- Bonsoir Denise, dit Germain, embarrass√© et sans faire un pas.\n- Vous ne dormirez pas, vous le savez tr√®s bien. Vous √™tes trop inquiet.\n- √áa se voit tant que √ßa ?\n- Vous disiez que tout ce que vous demandiez √† la vie, c'√©tait l'apaisement.\n- Oui, l'oubli total.\n- Je ne peux pas vous offrir tant que √ßa. Mais quelques heures d'oubli, √ßa compte quand m√™me...\n- Taisez-vous, dit-il en lui mettant la main sur la bouche.\n\nElle pose sa main sur la sienne et la mord.\n\nSur le palier, Rolande se recule, enl√®ve ses lunettes et s'effondre en pleurant."
  },
  {
    "kind": "question",
    "text": "Pour chaque m√©decin ayant couch√© avec au moins l'une des personnes qui l'ont consult√©, affichez le nombre de celles-ci.",
    "query": "SELECT doctor, count(DISTINCT patient) AS patients\nFROM consultation C\nJOIN lovers L ON(patient in (person_1, person_2)\n                 AND doctor in (person_1, person_2))\nGROUP BY doctor",
    "formula": "salt_046(üëÄ + sum(bit_xor(C.hash + L.hash)) OVER ()) AS token",
    "tweak": "le plus grand de ces nombres",
    "entry_token": "122341303290277",
    "output_token": "1506443788874084"
  },
  {
    "kind": "hint",
    "text": "Ne surestimez pas la p√©n√©tration de ces pratiques dans le corps m√©dical. Vous comptez plusieurs fois les m√™mes patients.",
    "query": "SELECT doctor, count(patient) AS patients\nFROM consultation C\nJOIN lovers L ON(patient in (person_1, person_2)\n                 AND doctor in (person_1, person_2))\nGROUP BY doctor",
    "formula": "salt_046(üëÄ + sum(bit_xor(C.hash + L.hash)) OVER ()) AS token",
    "entry_token": "1506443788874141"
  },
  {
    "kind": "context",
    "text": "Le lendemain matin, de bonne heure, en allant visiter une malade, le docteur Germain trouve porte close. La voiture du docteur Bertrand est gar√©e devant la maison. Les gens commenceraient-ils √† se m√©fier de lui¬†?\n\nIl repart vers l'√©cole, soucieux. Peu de temps apr√®s qu'il est arriv√© chez lui, Denise entre √† son tour.\n\n- Tu es d√©j√† revenu ?\n- Tu vois.\n- Qu'est-ce que tu fais ?\n- Je regardais jouer les enfants.\n- Je croyais que tu n'aimais pas les gosses...\n- Je ne sais plus ce que j'aime. Mais quand on sort de toute cette boue, √ßa... √ßa repose un peu.\n\nDenise s'est approch√©e de lui.\n\n- Tu n'es pas tr√®s tendre, ce matin.\n- Non. Denise, √©coutez.\n- Tu me vouvoies ?\n- Je crains qu'il n'y ait entre nous un malentendu. Hier, vous me plaisiez, c'est vrai. Mais j'√©tais surtout tr√®s d√©prim√©, tr√®s nerveux. Je suis rest√© pr√®s de vous autant par d√©couragement que par d√©sir. Vous comprenez ?\n- Je serais vraiment trop b√™te.\n- Non, vous ne comprenez pas. √áa n'a aucune importance, d'ailleurs... J'ai d√©cid√© de quitter la ville.\n- En ce moment, ce serait vous avouer coupable.\n- Aussi, j'attendrai que cette affaire soit r√©gl√©e.\n- Et d'ici l√† ?\n- Nous serons des amis, si vous voulez bien...\n- Des amis ? Tu vois une femme comme moi √™tre l'amie d'un homme comme toi ? Apr√®s cette nuit¬†? Vous me m√©sestimez, mon cher.\n- R√©fl√©chissez...\n- C'est tout r√©fl√©chi. Tu es l√¢che. Tu es faible. De nous deux, c'est toi la grue. Mais √ßa m'est √©gal, je ne c√®derai pas. Hier, tu m'as vue boiter parce que j'avais les pieds nus. Mais quand j'ai mes chaussures, personne ne s'aper√ßoit de rien. J'ai mis cinq ans pour arriver √† ce r√©sultat. J'ai r√©ussi. Et tous les hommes que j'ai voulus, je les ai eus. Moi, l'infirme. Et chaque fois, c'est une revanche que je prends sur la vie. Maintenant, tu feras ce que tu voudras. Tu es pr√©venu, tu sais √† qui tu as affaire.\n\nElle sort en claquant la porte."
  },
  {
    "kind": "question",
    "text": "Pour chaque patient, donner le nombre de m√©decins qu'il consulte. Triez par nombre de m√©decins d√©croissant et par patient croissant.",
    "query": "SELECT patient, count(DISTINCT doctor) AS doctors\nFROM consultation A\nGROUP BY patient\nORDER BY doctors DESC, patient ASC",
    "formula": "salt_036(üëÄ + sum(bit_xor(A.hash)* count(*)) OVER()) AS token",
    "tweak": "le plus grand de ces nombres",
    "entry_token": "1506443788874084",
    "output_token": "22846319067556395"
  },
  {
    "kind": "hint",
    "text": "Vous comptez le nombre de consultations de chaque patient, et non le nombre de m√©decins qu'il a consult√©s.",
    "query": "SELECT patient, count(doctor) AS doctors\nFROM consultation A\nGROUP BY patient\nORDER BY doctors DESC, patient ASC\nLIMIT 5",
    "formula": "salt_036(üëÄ + sum(bit_xor(A.hash)* count(*)) OVER()) AS token",
    "entry_token": "22846319067529663"
  },
  {
    "kind": "epilog",
    "text": "√Ä suivre‚Ä¶",
    "entry_token": "22846319067556395"
  }
]